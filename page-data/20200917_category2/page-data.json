{"componentChunkName":"component---src-templates-blog-post-js","path":"/20200917_category2/","result":{"data":{"site":{"siteMetadata":{"title":"amaNekublog"}},"markdownRemark":{"id":"752eda4a-a0ec-5248-9917-1ee563d01798","excerpt":"前回に引き続き、GatsbyJSを使ったカテゴリ別記事一覧ページの作成について解説します。 今回は以下の手順の3,4を解説します。 markdownファイルのfrontmatterに「カテゴリ」を追加する クエリを記述して、投稿のすべてのカテゴリを取得する カテゴリページテンプレートを作成する（/{category…","html":"<p>前回に引き続き、GatsbyJSを使ったカテゴリ別記事一覧ページの作成について解説します。</p>\n<p>今回は以下の手順の3,4を解説します。</p>\n<ol>\n<li>markdownファイルのfrontmatterに「カテゴリ」を追加する</li>\n<li>クエリを記述して、投稿のすべてのカテゴリを取得する</li>\n<li>カテゴリページテンプレートを作成する（/{category}に）</li>\n<li>そのテンプレートを使用してページをレンダリングするようにgatsby-node.jsを変更する</li>\n</ol>\n<h2>1. 実装</h2>\n<hr>\n<h3>1-1. カテゴリページテンプレートを作成する（/{category}に）</h3>\n<p>カテゴリのページは複数作成したいです。一つずつ作成することもできますが、それだと効率が悪い（カテゴリのページを修正したい場合、複数個同じ修正が必要）ですよね。そこで、カテゴリページ用のテンプレートを作成します。</p>\n<p>ページのテンプレートは <code class=\"language-text\">/src/templates</code> に配置します。すでにブログ記事ページ用のテンプレートファイル <code class=\"language-text\">blog-post.js</code> が置いてありますね。ここに <code class=\"language-text\">category.js</code> という名前でテンプレートファイルを新規作成します。</p>\n<p>ファイルの内容ですが、カテゴリページはホームページ（記事一覧ページ）と同じレイアウトにしたいので、<code class=\"language-text\">/src/pages/index.js</code> を流用することにしました。結果、以下のようになりました。</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Link<span class=\"token punctuation\">,</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"gatsby\"</span>\n\n<span class=\"token keyword\">import</span> Layout <span class=\"token keyword\">from</span> <span class=\"token string\">\"../components/layout\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token constant\">SEO</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../components/seo\"</span>\n<span class=\"token keyword\">import</span> Postcategory <span class=\"token keyword\">from</span> <span class=\"token string\">\"../components/postcategory\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> rhythm <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../utils/typography\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">CategoryTemplate</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> pageContext<span class=\"token punctuation\">,</span> location <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> siteTitle <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token punctuation\">.</span>title\n  <span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>allMarkdownRemark<span class=\"token punctuation\">.</span>edges\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> category <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> pageContext\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Layout</span></span> <span class=\"token attr-name\">location</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>location<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">title</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>siteTitle<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SEO</span></span> <span class=\"token attr-name\">title</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>category<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> | amaNekublog</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>category<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>hr</span>\n        <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n          marginBottom<span class=\"token operator\">:</span> <span class=\"token function\">rhythm</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>posts<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> node <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> title <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>title <span class=\"token operator\">||</span> node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>slug\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>article</span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>slug<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>header</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h3</span>\n                <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n                  marginBottom<span class=\"token operator\">:</span> <span class=\"token function\">rhythm</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n              <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n                </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Link</span></span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> boxShadow<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">none</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">to</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>slug<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n                  </span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n                </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Link</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h3</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>small</span>\n                <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n                  display<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">block</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n                  marginBottom<span class=\"token operator\">:</span> <span class=\"token function\">rhythm</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n              <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n                </span><span class=\"token punctuation\">{</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>small</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>header</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Postcategory</span></span> <span class=\"token attr-name\">postcategory</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>category<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>article</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Layout</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> CategoryTemplate\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  query($category: String) {\n    site {\n      siteMetadata {\n        title\n      }\n    }\n    allMarkdownRemark(\n      sort: { fields: [frontmatter___date], order: DESC }\n      filter: { frontmatter: { category: { in: [$category] } } }\n    ) {\n      edges {\n        node {\n          excerpt\n          fields {\n            slug\n          }\n          frontmatter {\n            date(formatString: \"YYYY.MM.DD\")\n            title\n            description\n            category\n          }\n        }\n      }\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span></code></pre></div>\n<p>以下、詳細解説</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">CategoryTemplate</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> pageContext<span class=\"token punctuation\">,</span> location <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> CategoryTemplate</code></pre></div>\n<p>Gatsbyにページレンダリングをしてもらいたいページの基を「<code class=\"language-text\">CategoryTemplate</code>」として定義し、それをデフォルトエクスポートします。関数の引数に渡されるものは次の通り。</p>\n<ul>\n<li><code class=\"language-text\">data</code>：このソース内のGraphQLクエリの結果</li>\n<li><code class=\"language-text\">pageContext</code>：コンテキスト情報。任意に設定でき、ここではカテゴリ名が渡されるようにしています。</li>\n<li><code class=\"language-text\">lacation</code>：ページのパス</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\">export const pageQuery <span class=\"token operator\">=</span> graphql`\n  <span class=\"token keyword\">query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$category</span><span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    site <span class=\"token punctuation\">{</span>\n      siteMetadata <span class=\"token punctuation\">{</span>\n        title\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    allMarkdownRemark<span class=\"token punctuation\">(</span>\n      <span class=\"token attr-name\">sort</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">fields</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>frontmatter___date<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">order</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">DESC</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token attr-name\">filter</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">frontmatter</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">category</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">in</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token variable\">$category</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      edges <span class=\"token punctuation\">{</span>\n        node <span class=\"token punctuation\">{</span>\n          excerpt\n          fields <span class=\"token punctuation\">{</span>\n            slug\n          <span class=\"token punctuation\">}</span>\n          frontmatter <span class=\"token punctuation\">{</span>\n            date<span class=\"token punctuation\">(</span><span class=\"token attr-name\">formatString</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"YYYY.MM.DD\"</span><span class=\"token punctuation\">)</span>\n            title\n            description\n            category\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n`</code></pre></div>\n<p>前回解説したGraphQLです。ここでは変数名を <code class=\"language-text\">pageQuery</code> としていますが、決まりはないそうです。この結果が <code class=\"language-text\">CategoryTemplate</code> の引数 <code class=\"language-text\">data</code> に渡されます。また、コンテキスト情報はこのクエリのパラメータ(<code class=\"language-text\">$category: String</code>)としても利用でき、特定のカテゴリだけがフィルターにかかるようにしています。</p>\n<h3>1-2. そのテンプレートを使用してページをレンダリングするようにgatsby-node.jsを変更する</h3>\n<p>ページを動的にレンダリングする場合は、GatsbyのNode APIの一つ「<code class=\"language-text\">CreatePages</code>」を利用します。</p>\n<p>Node APIを利用するには、プロジェクトのルート直下にある<code class=\"language-text\">gatsby-node.js</code>にて実装し、それをエクスポートします。gatsby-starter-blogでは、すでに記事ページ作成用に<code class=\"language-text\">CreatePages</code>を実装していましたので、これを少し修正するだけでOKです。</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> graphql<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createPage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> actions\n\n  <span class=\"token keyword\">const</span> blogPostTemplate <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./src/templates/blog-post.js</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> categoryTemplate <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./src/templates/category.js</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n      {\n        allMarkdownRemark(\n          sort: { fields: [frontmatter___date], order: DESC }\n          limit: 1000\n        ) {\n          edges {\n            node {\n              fields {\n                slug\n              }\n              frontmatter {\n                title\n              }\n            }\n          }\n        }\n        site {\n          siteMetadata {\n            categories {\n              name\n            }\n          }\n        }\n      }\n    </span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> result<span class=\"token punctuation\">.</span>errors\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Create blog posts pages.</span>\n  <span class=\"token comment\">// ※省略</span>\n\n  <span class=\"token comment\">// Create category pages.</span>\n  <span class=\"token keyword\">const</span> categories <span class=\"token operator\">=</span> result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token punctuation\">.</span>categories\n\n  categories<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">category</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      path<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>category<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      component<span class=\"token operator\">:</span> categoryTemplate<span class=\"token punctuation\">,</span>\n      context<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        category<span class=\"token operator\">:</span> category<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>以下、詳細解説</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> categoryTemplate <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./src/templates/category.js</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>1-1. で作成したテンプレートのソースコードを読み込んでいます。</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span>\n  <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    {\n      allMarkdownRemark(\n        //省略\n      site {\n        siteMetadata {\n          categories {\n            name\n          }\n        }\n      }\n    }\n  </span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>GraphQLです。<code class=\"language-text\">allMarkdownRemark</code> の箇所は記事ページで必要なクエリなので、省略します。<code class=\"language-text\">site</code> の箇所では、あらかじめメタデータとして<code class=\"language-text\">gatsby-config.js</code>に登録しておいた、本ブログの全カテゴリの名前を取得しています。</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> categories <span class=\"token operator\">=</span> result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token punctuation\">.</span>categories\n\ncategories<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">category</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    path<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>category<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    component<span class=\"token operator\">:</span> categoryTemplate<span class=\"token punctuation\">,</span>\n    context<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      category<span class=\"token operator\">:</span> category<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>各カテゴリごとに <code class=\"language-text\">CreatePage</code> を呼び出しています。<code class=\"language-text\">CreatePage</code> は、<code class=\"language-text\">CreatePages</code> で引数として渡している <code class=\"language-text\">actions</code> に含まれる関数の一つ（<code class=\"language-text\">const { createPage } = actions</code> で読み込み済み）です。<code class=\"language-text\">CreatePage</code> はその名の通りページを作成するための関数です。渡す引数は次の通り。</p>\n<ul>\n<li><code class=\"language-text\">path</code>：作成するページのパス。単純にカテゴリ名にします。</li>\n<li><code class=\"language-text\">component</code>：読み込み済みのテンプレートのソースコードへのパス。</li>\n<li><code class=\"language-text\">context</code>：ページコンテキスト。テンプレート側で使います。</li>\n</ul>\n<h2>2. 完成</h2>\n<p>カテゴリ別の記事一覧ページができました！</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/amaNekublog/static/b282def7fc1bed73d76da4e218d4fb06/78597/categorypage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.24324324324323%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAACOklEQVQ4y61U227TQBD1/38Cf8AjvPACEn0AJFChNC1O2yRO0sRx4vtlL75sTmdsqyRRk0jQkUa7OzMe75w5O9bS2+DqZoif1zb+3E8wsB8QJSlYttstDuUl265YQmrEaY40L5AVEkmWoxAK/FljtjCslKRuzHMyXo+plcga66yEKA3CooKoDCJRodA1MsU+jVRV2NAqq6ZPeOKGh+U0dBNWYzptzN89K8eYA9uuzwrCGO7ah+v5kEqfLemcUsII0/kSzuwRQir8i+wlZDhqQ0obxkiWNXLCj9dUVkhECZ/wi2gN8rK1F7pCTGdWRd90MPQJvUzh1yLBrZvhdpnhMZKYBAKLWGGwSHE5i/HR9jEg37dJhKAo4ZD/mnw/pjG8VO/RycrWATx7BJ1kONvCI2J2S64fpsg/XGC7WOE1xEqZa4QNl+KlquWdvepKXyWq1SmVyJCwzfEFlmRzky526OWYhbL1ybKBxY7Pdz7e/17hjpwcPN4UWBE2If1kToH367zFjc/8AyY57/28w5Nj2SY4YSr5UFAH1euUXNhjeO8+oZy7HcD8SnqAdzl2ioP7T4+6W00XAA2HPuS523WfnFdNfFO9Ml81kZe1Jv6xj8vlYWKNQoULJ4W9FhhSMxiviV/guxPROW/JzDjNQtE2gPnHvPwyCvF1HBF+iuIFRoT7hmItP9e4ImLPY9lerOnHVdWPq2PltvYXfJYIIkTjGTTNxFPE3n2vx3xdwssbuG/eQg8nndOY/5o2T+6Dxm+Q+LKfAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"categorypage.png\"\n        title=\"categorypage.png\"\n        src=\"/amaNekublog/static/b282def7fc1bed73d76da4e218d4fb06/fcda8/categorypage.png\"\n        srcset=\"/amaNekublog/static/b282def7fc1bed73d76da4e218d4fb06/12f09/categorypage.png 148w,\n/amaNekublog/static/b282def7fc1bed73d76da4e218d4fb06/e4a3f/categorypage.png 295w,\n/amaNekublog/static/b282def7fc1bed73d76da4e218d4fb06/fcda8/categorypage.png 590w,\n/amaNekublog/static/b282def7fc1bed73d76da4e218d4fb06/efc66/categorypage.png 885w,\n/amaNekublog/static/b282def7fc1bed73d76da4e218d4fb06/78597/categorypage.png 947w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>以上です。今回の改修で何となくGatsbyJSのことや、JavaScriptのことがわかってきたので、良い挑戦ができたなと感じています。が、、まだまだブログとしてはいけてないので、少しずつ改善していけたらと思います。今後はブログをカスタマイズしたときに気まぐれに更新していこうと思います。</p>","frontmatter":{"title":"【GatsbyJS】カテゴリ別の記事一覧ページを作る②","date":"2020.09.17","description":null,"category":"Develop"}}},"pageContext":{"slug":"/20200917_category2/","previous":{"fields":{"slug":"/20200915_category1/"},"frontmatter":{"title":"【GatsbyJS】カテゴリ別の記事一覧ページを作る①"}},"next":null}},"staticQueryHashes":["1317458740","2228689422","2841359383","3644837815"]}